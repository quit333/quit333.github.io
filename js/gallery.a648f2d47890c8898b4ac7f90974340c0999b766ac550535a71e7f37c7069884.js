(()=>{window.addEventListener("load",()=>{let c=document.querySelector("article"),q=document.getElementById("top-button"),l=document.getElementById("gallery"),f=0,h=[],d=window.getComputedStyle(l),y=parseInt(d.rowGap),b=parseInt(d.columnGap),i="";fetch("media.json").then(n=>n.json()).then(n=>{i=n.gallery_name,h=n.media,g()});function g(){c.scrollHeight<=c.clientHeight+200&&(w(),setTimeout(g,100))}function w(){let n=f*5,e=n+5;h.slice(n,e).forEach(s=>{let a=s.toLowerCase();if([".jpg",".jpeg",".png",".webp"].some(t=>a.endsWith(t))){let t=document.createElement("img"),r=s,o=`${r.split(".").slice(0,-1)}`;t.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/thumbnails/${o}.webp`;let p=document.createElement("a");p.href=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/images/${r}`,p.target="_blank",p.rel="noopener noreferrer",p.appendChild(t),t.addEventListener("load",()=>u(p))}else if(a.endsWith(".gif")){let t=document.createElement("img");t.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/videos/${s}`;let r=document.createElement("a");r.href=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/videos/${s}`,r.target="_blank",r.rel="noopener noreferrer",r.appendChild(t),t.addEventListener("load",()=>u(r))}else if(a.startsWith("http"))if(a.includes("youtube.com")){let t=document.createElement("iframe");t.id="player",t.type="text/html",t.src=s,t.allowFullscreen=!0,u(t)}else{let t=document.createElement("video");t.autoplay=!0,t.loop=!0,t.muted=!0,t.dataset.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/videos/${s}`;let r=document.createElement("source");r.src=s,t.appendChild(r);let o=document.createElement("a");o.href=a,o.target="_blank",o.rel="noopener noreferrer",o.appendChild(t),t.addEventListener("loadeddata",()=>{u(o),E.observe(o)})}else if([".mp4",".webm"].some(t=>a.endsWith(t))){let t=document.createElement("video");t.autoplay=!0,t.loop=!0,t.muted=!0,t.dataset.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/videos/${s}`;let r=document.createElement("source");r.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/videos/${s}`,t.appendChild(r);let o=document.createElement("a");o.href=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${i}/videos/${s}`,o.target="_blank",o.rel="noopener noreferrer",o.appendChild(t),t.addEventListener("loadeddata",()=>{u(o),E.observe(o)})}}),f++}function u(n){let e=document.createElement("div");e.className="gallery-item",e.appendChild(n),l.appendChild(e),v(e)}function v(n){let e=n.querySelector("img, video, iframe");if(!e||e.tagName==="IMG"&&!e.complete||e.tagName==="VIDEO"&&e.readyState<2)return;let m=e.clientHeight,a=Math.ceil(m/b);n.style.gridRowEnd=`span ${a}`}let E=new IntersectionObserver(n=>{n.forEach(e=>{e.isIntersecting?$(e.target):k(e.target)})},{root:c,threshold:.5});function k(n){let e=n.querySelector("video");e&&e.pause()}function $(n){let e=n.querySelector("video");e&&e.play().catch(()=>{})}q.addEventListener("click",()=>{C()});function C(){S(h),l.querySelectorAll(".gallery-item").forEach(e=>{e.remove()}),g()}function S(n){let e=n.length;for(;e!=0;){let m=Math.floor(Math.random()*e);e--,[n[e],n[m]]=[n[m],n[e]]}}c.addEventListener("scroll",()=>{c.scrollTop>=c.scrollHeight-c.clientHeight-500&&w()}),window.addEventListener("resize",()=>{let n=l.querySelectorAll(".gallery-item");d=window.getComputedStyle(l),y=parseInt(d.rowGap),b=parseInt(d.columnGap),n.forEach(e=>{v(e)})})});console.log("Mureinoki \xB7 2025");})();
