(()=>{window.addEventListener("load",()=>{let c=document.querySelector("article"),m=document.getElementById("gallery"),p=0,h=[],l=window.getComputedStyle(m),y=parseInt(l.rowGap),g=parseInt(l.columnGap),a="";fetch("media.json").then(r=>r.json()).then(r=>{a=r.gallery_name,h=r.media,f()});function f(){c.scrollHeight<=c.clientHeight+200&&(b(),setTimeout(f,100))}function b(){let r=p*5,t=r+5;h.slice(r,t).forEach(s=>{let i=s.toLowerCase();if([".jpg",".jpeg",".png",".webp"].some(e=>i.endsWith(e))){let e=document.createElement("img"),o=s,n=`${o.split(".").slice(0,-1)}`;e.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/thumbnails/${n}.webp`;let u=document.createElement("a");u.href=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/images/${o}`,u.target="_blank",u.rel="noopener noreferrer",u.appendChild(e),e.addEventListener("load",()=>d(u))}else if(i.endsWith(".gif")){let e=document.createElement("img");e.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/videos/${s}`;let o=document.createElement("a");o.href=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/videos/${s}`,o.target="_blank",o.rel="noopener noreferrer",o.appendChild(e),e.addEventListener("load",()=>d(o))}else if(i.startsWith("http"))if(i.includes("youtube.com")){let e=document.createElement("iframe");e.id="player",e.type="text/html",e.src=s,e.frameBorder="0",e.allowFullscreen=!0,e.width="100%",e.style.background="black",d(e)}else{let e=document.createElement("video");e.autoplay=!0,e.loop=!0,e.muted=!0,e.dataset.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/videos/${s}`;let o=document.createElement("source");o.src=s,e.appendChild(o);let n=document.createElement("a");n.href=i,n.target="_blank",n.rel="noopener noreferrer",n.appendChild(e),e.addEventListener("loadeddata",()=>{d(n),v.observe(n)})}else if([".mp4",".webm"].some(e=>i.endsWith(e))){let e=document.createElement("video");e.autoplay=!0,e.loop=!0,e.muted=!0,e.dataset.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/videos/${s}`;let o=document.createElement("source");o.src=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/videos/${s}`,e.appendChild(o);let n=document.createElement("a");n.href=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${a}/videos/${s}`,n.target="_blank",n.rel="noopener noreferrer",n.appendChild(e),e.addEventListener("loadeddata",()=>{d(n),v.observe(n)})}}),p++}function d(r){let t=document.createElement("div");t.className="gallery-item",t.appendChild(r),m.appendChild(t),w(t)}function w(r){let t=r.querySelector("img, video, iframe");if(!t||t.tagName==="IMG"&&!t.complete||t.tagName==="VIDEO"&&t.readyState<2)return;let E=t.clientHeight,i=Math.round(E/g);r.style.gridRowEnd=`span ${i}`}let v=new IntersectionObserver(r=>{r.forEach(t=>{t.isIntersecting?k(t.target):q(t.target)})},{root:c,threshold:.5});function q(r){let t=r.querySelector("video");t&&t.pause()}function k(r){let t=r.querySelector("video");t&&t.play().catch(()=>{})}c.addEventListener("scroll",()=>{c.scrollTop>=c.scrollHeight-c.clientHeight-500&&b()}),window.addEventListener("resize",()=>{let r=m.querySelectorAll(".gallery-item");l=window.getComputedStyle(m),y=parseInt(l.rowGap),g=parseInt(l.columnGap),r.forEach(t=>{w(t)})})});console.log("Mureinoki \xB7 2025");})();
