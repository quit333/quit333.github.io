(()=>{window.addEventListener("load",()=>{let r=document.querySelector("article"),y=document.getElementById("top-button"),s=document.getElementById("gallery"),c=0,a=[],l,E,d="";u(),fetch("media.json").then(t=>t.json()).then(t=>{d=t.gallery_name,a=t.media,i()});function i(){r.scrollHeight<=r.clientHeight+200&&(p(),setTimeout(i,100))}function u(){let t=window.getComputedStyle(s);l=parseInt(t.rowGap),E=parseInt(t.columnGap)}function p(){a.slice(c*5,(c+1)*5).forEach(e=>b(e)),c++}function b(t){let e=t.toLowerCase(),n=`https://raw.githubusercontent.com/quit333/quit3-backup/refs/heads/master/${d}`;if([".jpg",".jpeg",".png",".webp"].some(o=>e.endsWith(o))){let o=t.split(".").slice(0,-1).join(".");m(`${n}/images/${t}`,`${n}/thumbnails/${o}.webp`)}else e.endsWith(".gif")?m(`${n}/videos/${t}`,`${n}/videos/${t}`):e.startsWith("http")?e.includes("youtube.com")||h(t):[".mp4",".webm"].some(o=>e.endsWith(o))&&h(`${n}/videos/${t}`)}function m(t,e){let n=document.createElement("img");n.src=e;let o=document.createElement("a");o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.appendChild(n),n.addEventListener("load",()=>f(o))}function h(t){let e=document.createElement("video");e.autoplay=!0,e.loop=!0,e.muted=!0,e.dataset.src=t;let n=document.createElement("source");n.src=t,e.appendChild(n);let o=document.createElement("a");o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.appendChild(e),e.addEventListener("loadeddata",()=>{e.closest(".gallery-item")||(f(o),v.observe(e))})}function f(t){let e=document.createElement("div");e.className="gallery-item",e.appendChild(t),s.appendChild(e),g(e)}function g(t){let e=t.querySelector("img, video, iframe");if(e.tagName==="VIDEO"&&e.readyState<2)return;let n=e.clientHeight,o=Math.ceil(n/l);t.style.gridRowEnd=`span ${o}`}let v=new IntersectionObserver(t=>{t.forEach(e=>{let n=e.target;if(n.tagName==="VIDEO")if(e.isIntersecting){if(!n.querySelector("source")){let o=document.createElement("source");o.src=n.dataset.src,n.appendChild(o),n.load()}n.play()}else{n.pause();let o=n.querySelector("source");o&&(o.remove(),n.load())}})},{root:r,rootMargin:"100px 0px 20px 0px"});y.addEventListener("click",()=>{w(a),s.innerHTML="",c=0,i()});function w(t){for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}r.addEventListener("scroll",()=>{r.scrollTop>=r.scrollHeight-r.clientHeight-500&&p()}),window.addEventListener("resize",()=>{u(),document.querySelectorAll(".gallery-item").forEach(g)})});})();
